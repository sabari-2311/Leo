<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Snake Game with Image Background</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      color: #0f0;
      margin: 0;
      background: black;
    }

    canvas {
      display: block;
      margin: 20px auto;
      border: 2px solid #0f0;
      background: black;
    }

    .controls {
      margin-top: 10px;
    }

    select, button {
      padding: 5px 10px;
      font-size: 16px;
      margin: 5px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Snake Game</h1>
  <p>Use Arrow Keys or WASD to move. Press <strong>Spacebar</strong> to pause/resume.</p>

  <div class="controls" id="controls">
    <label for="difficulty">Select Difficulty:</label>
    <select id="difficulty">
      <option value="" selected disabled>-- Choose --</option>
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button id="startBtn">Start Game</button>
  </div>

  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const startBtn = document.getElementById("startBtn");
    const difficultySelect = document.getElementById("difficulty");
    const controls = document.getElementById("controls");

    // Reduced grid size and fixed dimensions
    const gridSize = 20;      // Size of each tile
    const tileCount = 20;     // 20 x 20 grid
    canvas.width = gridSize * tileCount;
    canvas.height = gridSize * tileCount;

    let snake, food, dx, dy, score, frame;
    let currentSpeed = 10;
    let trueSpeed = 10;
    let gameStarted = false;
    let gamePaused = false;
    let gameStartTime = null;
    let difficulty = "medium";

    const bgImage = new Image();
    bgImage.src = "head.png"; // Ensure this image exists in the same folder

    function resetGame() {
      snake = [{ x: 5, y: 5 }];
      food = generateFood();
      dx = 1;
      dy = 0;
      score = 0;
      frame = 0;
      gameStartTime = Date.now();
    }

    function generateFood() {
      let newFood;
      while (true) {
        newFood = {
          x: Math.floor(Math.random() * tileCount),
          y: Math.floor(Math.random() * tileCount),
        };
        const isOnSnake = snake.some(segment => segment.x === newFood.x && segment.y === newFood.y);
        if (!isOnSnake) break;
      }
      return newFood;
    }

    function gameLoop() {
      requestAnimationFrame(gameLoop);

      if (!gameStarted || gamePaused) return;

      const elapsed = (Date.now() - gameStartTime) / 1000;
      if (difficulty === "hard") {
        currentSpeed = elapsed < 3 ? 10 : 5;
      }

      if (++frame % currentSpeed !== 0) return;

      // Draw background image
      ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);

      const head = { x: snake[0].x + dx, y: snake[0].y + dy };

      if (
        head.x < 0 || head.x >= tileCount ||
        head.y < 0 || head.y >= tileCount
      ) {
        alert("Game Over! Score: " + score);
        location.reload();
        return;
      }

      for (let i = 1; i < snake.length; i++) {
        if (snake[i].x === head.x && snake[i].y === head.y) {
          alert("Game Over! Score: " + score);
          location.reload();
          return;
        }
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        food = generateFood();
      } else {
        snake.pop();
      }

      // Draw food
      ctx.fillStyle = "red";
      ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);

      // Draw snake
      ctx.fillStyle = "black";
      for (let s of snake) {
        ctx.fillRect(s.x * gridSize, s.y * gridSize, gridSize, gridSize);
      }
    }

    document.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();

      if (key === " " && gameStarted) {
        e.preventDefault();
        gamePaused = !gamePaused;
        if (!gamePaused) {
          gameStartTime = Date.now() - (frame / currentSpeed) * 100;
        }
        return;
      }

      if (!gameStarted || gamePaused) return;

      switch (key) {
        case "arrowup":
        case "w":
          if (dy === 0) { dx = 0; dy = -1; }
          break;
        case "arrowdown":
        case "s":
          if (dy === 0) { dx = 0; dy = 1; }
          break;
        case "arrowleft":
        case "a":
          if (dx === 0) { dx = -1; dy = 0; }
          break;
        case "arrowright":
        case "d":
          if (dx === 0) { dx = 1; dy = 0; }
          break;
      }
    });

    startBtn.addEventListener("click", () => {
      const level = difficultySelect.value;
      if (!level) {
        alert("Please select a difficulty level!");
        return;
      }

      difficulty = level;

      if (level === "easy") {
        currentSpeed = 15;
        trueSpeed = 15;
      } else if (level === "medium") {
        currentSpeed = 10;
        trueSpeed = 10;
      } else if (level === "hard") {
        currentSpeed = 10;
        trueSpeed = 5;
      }

      controls.classList.add("hidden");

      resetGame();
      gameStarted = true;
      gamePaused = false;
      requestAnimationFrame(gameLoop);
    });

    window.addEventListener("resize", () => {
      location.reload(); // Reload on resize
    });
  </script>
</body>
</html>
